<!doctype html>
<html lang="ar" dir="rtl">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Ø¯ÙŠÙ…Ùˆ Ø³Ø§ÙŠØª â€” Ù…Ø´Ø§Ø±ÙŠØ¹ ÙˆØ±ÙˆØ§Ø¨Ø·</title>
  <link rel="stylesheet" href="styles.css">
  <!-- Load nicer Arabic fonts: Amiri (serif) for the brand title, Cairo (clean Arabic sans) for body -->
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Amiri&family=Cairo:wght@300;400;700&display=swap" rel="stylesheet">
</head>
<body>
  <header class="hero">
    <div class="container" style="position:relative">
      <div class="brand">
        <h1>Ø¯ÙŠÙ…Ùˆ Ø³Ø§ÙŠØª</h1>
        <p class="tag" data-i18n="tagline">Ù…Ø­ÙØ¸Ø© ÙˆØ±ÙˆØ§Ø¨Ø· Ø®Ø§ØµØ© â€” Ø¹Ø±Ø¶ Ø³Ø±ÙŠØ¹ Ù„Ù…Ø´Ø±ÙˆØ¹Ø§ØªÙŠ ÙˆØ±ÙˆØ§Ø¨Ø·ÙŠ Ø§Ù„Ù…Ù‡Ù…Ø©</p>
      </div>
      <!-- header controls: dark mode + language -->
      <div class="header-controls">
        <label class="hdr-switch" aria-label="Ø§Ù„ÙˆØ¶Ø¹ Ø§Ù„Ù„ÙŠÙ„ÙŠ"><input type="checkbox" id="darkToggle" /><span class="icon" aria-hidden="true">ğŸŒ™</span></label>
        <select id="langSelect" aria-label="language">
          <option value="ar">Ø§Ù„Ø¹Ø±Ø¨ÙŠØ©</option>
          <option value="en">English</option>
        </select>
      </div>
    </div>
  </header>

  <main class="container">
    <section id="projects" class="section">
      <h2 data-i18n="projects_h2" style="text-align:center">Ø§Ù„Ù…Ø´Ø§Ø±ÙŠØ¹</h2>
      <div class="grid">
        <article class="card">
          <div class="card-head" data-i18n="project1_title">Ø±ÙˆØ§Ø¨Ø· Ù…ÙˆÙ‚Ø¹ÙŠ</div>
          <p class="muted" data-i18n="project1_desc">Ù…ÙˆØ§Ù‚Ø¹ Ø§Ù„ØªØ¬Ø±ÙŠØ¨ÙŠÙ‡ Ø®Ø§ØµÙ‡ Ø¨ÙŠ</p>
          <div class="actions">
            <a class="muted" href="https://ahmadnhan.github.io/mysite/" target="_blank" rel="noopener" data-i18n="converter_site_link">Ù…ÙˆÙ‚Ø¹ ØªØ­ÙˆÙŠÙ„ Ø§Ù„ØªØ§Ø±ÙŠØ®</a>
          </div>
        </article>
        <article class="card">
          <div class="card-head" data-i18n="project2_title">ØªØ·Ø¨ÙŠÙ‚Ø§ØªÙŠ</div>
          <p class="muted">Ø±ÙˆØ§Ø¨Ø· ØªØ­Ù…ÙŠÙ„ ØªØ·Ø¨ÙŠÙ‚Ø§Øª</p>
          <div class="actions">
            <a class="muted" href="https://www.mediafire.com/file/fekgcz3s4tl8326/app3719549-ghn059.apk/file" target="_blank" rel="noopener" data-i18n="app_converter_title">ØªØ·Ø¨ÙŠÙ‚ ØªØ­ÙˆÙŠÙ„ ØªØ§Ø±ÙŠØ®</a>
          </div>
        </article>
  <!-- Ù…ÙˆÙ‚Ø¹ Ø´Ø®ØµÙŠ removed as requested -->
      </div>
    </section>

  <!-- links section removed per request -->

      <!-- New: file sharing card (Ø¸Ù‡Ø± Ù‚Ø¨Ù„ ØªÙˆØ§ØµÙ„) -->
      <section id="share" class="section">
        <h2 style="text-align:center">Ù…Ø´Ø§Ø±ÙƒØ© Ù…Ù„ÙØ§Øª Ø¹Ø¨Ø± Ø§Ù„Ù…ÙˆÙ‚Ø¹</h2>
        <div class="card">
          <div class="card-head">Ù…Ø´Ø§Ø±ÙƒØ© Ù…Ù„ÙØ§Øª Ø¹Ø¨Ø± Ø§Ù„Ù…ÙˆÙ‚Ø¹</div>
          <p class="muted">ÙŠÙ…ÙƒÙ†Ùƒ Ø§Ø®ØªÙŠØ§Ø± Ù…Ù„Ù Ù„Ù…Ø´Ø§Ø±ÙƒØªÙ‡ Ø¹Ø¨Ø± Ø±Ø§Ø¨Ø· (ØªØ¬Ø±ÙŠØ¨ÙŠ). Ù‡Ø°Ù‡ Ø§Ù„ÙˆØ§Ø¬Ù‡Ø© ØªÙˆØ¶ÙŠØ­ÙŠØ© ÙÙ‚Ø· ÙˆÙ„Ø§ ØªØ±ÙØ¹ Ø§Ù„Ù…Ù„Ù ÙØ¹Ù„ÙŠÙ‹Ø§ ÙÙŠ Ù‡Ø°Ø§ Ø§Ù„Ø¥ØµØ¯Ø§Ø±.</p>
          <div class="actions">
            <label class="btn" style="cursor:pointer">
              <input type="file" id="fileInput" style="display:none" accept="*/*" multiple />
              Ø±ÙØ¹ Ù…Ù„Ù
            </label>
            <input id="urlInput" type="url" placeholder="Ø§Ù„ØµÙ‚ Ø±Ø§Ø¨Ø· (ØµÙˆØ±Ø©/ÙÙŠØ¯ÙŠÙˆ/Ù…ÙŠØ¯ÙŠØ§) ÙˆØ£Ø¶Ù" style="margin-inline-start:8px;padding:6px;border-radius:6px;border:1px solid var(--muted,#ccc)" />
            <button id="addUrlBtn" class="btn" style="margin-inline-start:6px">Ø£Ø¶Ù Ø±Ø§Ø¨Ø·</button>
            
            <div id="uploadHint" class="muted" style="display:block;margin-top:8px">Ù„Ù… ÙŠØªÙ… Ø§Ø®ØªÙŠØ§Ø± Ù…Ù„ÙØ§Øª Ø£Ùˆ Ø±ÙˆØ§Ø¨Ø·</div>
          </div>
          <div id="sharePreview" class="share-preview" style="margin-top:10px"></div>
        </div>
      </section>

    <section id="contact" class="section">
      <h2 data-i18n="contact_h2">ØªÙˆØ§ØµÙ„</h2>
      <div class="contact">
        <p class="muted" data-i18n="contact_text">ÙŠÙ…ÙƒÙ†Ùƒ ÙˆØ¶Ø¹ Ø¥ÙŠÙ…ÙŠÙ„ Ø£Ùˆ Ù†Ù…ÙˆØ°Ø¬ ØªÙˆØ§ØµÙ„ Ù‡Ù†Ø§.</p>
        <div class="contact-info">
          <a class="email green-btn" href="mailto:ahmad14088@gmail.com" aria-label="ahmad14088@gmail.com" title="ahmad14088@gmail.com">
            <span class="mail-icon" aria-hidden="true">âœ‰ï¸</span>
          </a>
        </div>
  <!-- contact actions removed per request -->
      </div>
    </section>

    <footer class="site-footer">
  <div>Â© <span id="year"></span> <span class="site-name" data-i18n="site_name">Ø¯ÙŠÙ…Ùˆ Ø³Ø§ÙŠØª</span> â€” <span data-i18n="rights">Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø­Ù‚ÙˆÙ‚ Ù…Ø­ÙÙˆØ¸Ø©</span></div>
    </footer>
  </main>

  <script>
    document.getElementById('year').textContent = new Date().getFullYear();
  // copy email listener removed (button removed)

    // Dark mode toggle + persistence
    const darkToggle = document.getElementById('darkToggle');
    function setDark(on){
      if(on) document.documentElement.classList.add('dark');
      else document.documentElement.classList.remove('dark');
      try{ localStorage.setItem('demo_dark', on ? '1' : '0') }catch(e){}
      darkToggle.checked = !!on;
    }
    darkToggle.addEventListener('change', (e)=> setDark(e.target.checked));
    // restore theme from storage
    try{ if(localStorage.getItem('demo_dark') === '1') setDark(true) }catch(e){}

    // Simple i18n
    const i18n = {
      en: {
        tagline: 'Portfolio & links â€” quick view of my projects',
  projects_h2: 'Projects',
  project1_title: 'My site links',
  project1_desc: 'My demo sites',
  project2_title: 'My apps',
  project2_desc: 'Hijri/Gregorian date converter (downloadable).',
  app_converter_title: 'Date converter app',
        project3_title: 'Personal Site',
        project3_desc: 'Clean personal template for portfolio & resume.',
        tag_tool: 'Tool',
        tag_design: 'Design',
        tag_portfolio: 'Portfolio',
        btn_view: 'View',
        btn_repo: 'Repository',
  btn_download: 'Download',
  btn_download_site: 'View site',
  converter_site_link: 'Date converter site',
        links_h2: 'Quick Links',
        github_link: 'My GitHub',
        repos_link: 'My Repos',
        blog_link: 'My Blog',
        contact_h2: 'Contact',
        contact_text: 'Place an email or contact form here.',
        btn_copy_email: 'Copy email',
        btn_linkedin: 'Open LinkedIn',
        site_name: 'Demo Site',
        rights: 'All rights reserved'
      },
      ar: {
        tagline: 'Ù…Ø­ÙØ¸Ø© ÙˆØ±ÙˆØ§Ø¨Ø· Ø®Ø§ØµØ© â€” Ø¹Ø±Ø¶ Ø³Ø±ÙŠØ¹ Ù„Ù…Ø´Ø±ÙˆØ¹Ø§ØªÙŠ ÙˆØ±ÙˆØ§Ø¨Ø·ÙŠ Ø§Ù„Ù…Ù‡Ù…Ø©',
  projects_h2: 'Ø§Ù„Ù…Ø´Ø§Ø±ÙŠØ¹',
  project1_title: 'Ø±ÙˆØ§Ø¨Ø· Ù…ÙˆÙ‚Ø¹ÙŠ',
  project1_desc: 'Ù…ÙˆØ§Ù‚Ø¹ Ø§Ù„ØªØ¬Ø±ÙŠØ¨ÙŠÙ‡ Ø®Ø§ØµÙ‡ Ø¨ÙŠ',
  project2_title: 'ØªØ·Ø¨ÙŠÙ‚Ø§ØªÙŠ',
  project2_desc: 'Ù…Ø­ÙˆÙ„ ØªÙˆØ§Ø±ÙŠØ® Ù‡Ø¬Ø±ÙŠ/Ù…ÙŠÙ„Ø§Ø¯ÙŠ (Ù‚Ø§Ø¨Ù„ Ù„Ù„ØªØ­Ù…ÙŠÙ„).',
  app_converter_title: 'ØªØ·Ø¨ÙŠÙ‚ ØªØ­ÙˆÙŠÙ„ ØªØ§Ø±ÙŠØ®',
        project3_title: 'Ù…ÙˆÙ‚Ø¹ Ø´Ø®ØµÙŠ',
        project3_desc: 'Ù‚Ø§Ù„Ø¨ Ø´Ø®ØµÙŠ Ø£Ù†ÙŠÙ‚ Ù„Ù„Ù…Ø¹Ø±ÙˆØ¶Ø§Øª ÙˆØ§Ù„Ø³ÙŠØ±Ø© Ø§Ù„Ø°Ø§ØªÙŠØ©.',
        tag_tool: 'Ø£Ø¯Ø§Ø©',
        tag_design: 'ØªØµÙ…ÙŠÙ…',
        tag_portfolio: 'Ù…Ø­ÙØ¸Ø©',
        btn_view: 'Ø¹Ø±Ø¶',
        btn_repo: 'Ù…Ø³ØªÙˆØ¯Ø¹',
  btn_download: 'ØªØ­Ù…ÙŠÙ„',
  btn_download_site: 'Ø¹Ø±Ø¶ Ø§Ù„Ù…ÙˆÙ‚Ø¹',
  converter_site_link: 'Ù…ÙˆÙ‚Ø¹ ØªØ­ÙˆÙŠÙ„ Ø§Ù„ØªØ§Ø±ÙŠØ®',
        links_h2: 'Ø±ÙˆØ§Ø¨Ø·ÙŠ Ø§Ù„Ø³Ø±ÙŠØ¹Ø©',
        github_link: 'ØµÙØ­ØªÙŠ Ø¹Ù„Ù‰ GitHub',
        repos_link: 'Ù…Ø³ØªÙˆØ¯Ø¹Ø§ØªÙŠ',
        blog_link: 'Ù…Ø¯ÙˆÙ†ØªÙŠ',
        contact_h2: 'ØªÙˆØ§ØµÙ„',
        contact_text: 'ÙŠÙ…ÙƒÙ†Ùƒ ÙˆØ¶Ø¹ Ø¥ÙŠÙ…ÙŠÙ„ Ø£Ùˆ Ù†Ù…ÙˆØ°Ø¬ ØªÙˆØ§ØµÙ„ Ù‡Ù†Ø§.',
        btn_copy_email: 'Ù†Ø³Ø® Ø§Ù„Ø¥ÙŠÙ…ÙŠÙ„',
        btn_linkedin: 'ÙØªØ­ LinkedIn',
        site_name: 'Ø¯ÙŠÙ…Ùˆ Ø³Ø§ÙŠØª',
        rights: 'Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø­Ù‚ÙˆÙ‚ Ù…Ø­ÙÙˆØ¸Ø©'
      }
    };
    const langSelect = document.getElementById('langSelect');
    function applyLang(lang){
      document.documentElement.lang = lang;
      // set direction
      document.documentElement.dir = (lang === 'ar') ? 'rtl' : 'ltr';
      // translate elements with data-i18n
      document.querySelectorAll('[data-i18n]').forEach(el=>{
        const key = el.getAttribute('data-i18n');
        if(i18n[lang] && i18n[lang][key]) el.textContent = i18n[lang][key];
      });
      // translate buttons that have data-i18n
      document.querySelectorAll('.btn').forEach(b=>{
        const key = b.getAttribute('data-i18n');
        if(key && i18n[lang] && i18n[lang][key]) b.textContent = i18n[lang][key];
      });
      try{ localStorage.setItem('demo_lang', lang) }catch(e){}
    }
    langSelect.addEventListener('change', ()=>applyLang(langSelect.value));
    // restore language from storage or apply select value
    try{
      const saved = localStorage.getItem('demo_lang');
      if(saved){ langSelect.value = saved }
    }catch(e){}
    applyLang(langSelect.value);

    // Reveal animations using IntersectionObserver
    const io = new IntersectionObserver((entries)=>{
      entries.forEach(ent=>{
        if(ent.isIntersecting) ent.target.classList.add('in-view');
      });
    },{threshold:0.12});
    document.querySelectorAll('.card, .section').forEach(el=>{ el.classList.add('reveal'); io.observe(el) });
  </script>
  
  <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-app.js"></script>
  <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-firestore.js"></script>
  <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-storage.js"></script>
  <script src="firebase-config.js"></script>
  <script>
    // Advanced client-side preview for multiple files + links with local persistence
    // Firebase/Firestore optional integration for cross-device metadata
    // Fill FIREBASE config below to enable remote metadata storage
    const FIREBASE = (window.FIREBASE_CONFIG && window.FIREBASE_CONFIG.apiKey) ? window.FIREBASE_CONFIG : {
      apiKey: '',
      authDomain: '',
      projectId: '',
      storageBucket: '' // e.g. 'your-project-id.appspot.com'
    };
  // ØªÙØ¹ÙŠÙ„ Ø§Ù„ÙˆØ¶Ø¹ Ø§Ù„Ø³Ø­Ø§Ø¨ÙŠ ÙÙ‚Ø·: Ù„Ø§ Ø­ÙØ¸ Ù…Ø­Ù„ÙŠ Ø¹Ù†Ø¯ ØªÙˆØ§ÙØ± Firebase
  const ALWAYS_REMOTE = true; // Ù†ÙŠØ© Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…
  // ÙØ¹Ù„ÙŠÙ‹Ø§ Ù†ÙØ¹Ù‘Ù„ Ø§Ù„Ù‚ÙŠÙˆØ¯ Ø§Ù„Ø³Ø­Ø§Ø¨ÙŠØ© ÙÙ‚Ø· Ø¥Ø°Ø§ Firebase ØªØ¹Ù…Ù„
  let REMOTE_ACTIVE = false; // Ø³ÙŠÙØ¶Ø¨Ø· Ø¨Ø¹Ø¯ init
    let firebaseDb = null;
    function initFirebase(){
      try{
        if(!FIREBASE.apiKey || !FIREBASE.projectId) return false;
        firebase.initializeApp(FIREBASE);
        firebaseDb = firebase.firestore();
        return true;
      }catch(e){ console.warn('firebase init failed', e); return false; }
    }
  const FIREBASE_ENABLED = initFirebase();
  REMOTE_ACTIVE = ALWAYS_REMOTE && FIREBASE_ENABLED;
    // ØªØ­Ù…ÙŠÙ„ Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ù…Ù† localStorage Ø¥Ù† ÙˆØ¬Ø¯Øª
    (function loadDynamicFirebaseConfig(){
      // Ø£ÙˆÙ„ÙˆÙŠØ©: Ù…Ù„Ù firebase-config.js Ø«Ù… Ø§Ù„Ù…Ø®Ø²Ù† Ø§Ù„Ù…Ø­Ù„ÙŠ (Ù„Ù„Ø±Ø¬ÙˆØ¹)
      try{
        if(window.FIREBASE_CONFIG && window.FIREBASE_CONFIG.apiKey){
          if(!firebase.apps.length){ firebase.initializeApp(window.FIREBASE_CONFIG); }
          firebaseDb = firebase.firestore();
          REMOTE_ACTIVE = ALWAYS_REMOTE; setCloudStatus && setCloudStatus('Ù…ØªØµÙ„ Ø¨Ø§Ù„Ø³Ø­Ø§Ø¨Ø© (Ù…Ù„Ù Ø¥Ø¹Ø¯Ø§Ø¯)', true); subscribeRemote && subscribeRemote();
          return;
        }
        const raw = localStorage.getItem('demo_fb_cfg');
        if(raw){
          const cfg = JSON.parse(raw);
          if(cfg.apiKey && !firebase.apps.length){
            firebase.initializeApp(cfg); firebaseDb = firebase.firestore(); REMOTE_ACTIVE = ALWAYS_REMOTE; setCloudStatus && setCloudStatus('Ù…ØªØµÙ„ Ø¨Ø§Ù„Ø³Ø­Ø§Ø¨Ø© (Ù…Ø­Ù„ÙŠ)', true); subscribeRemote && subscribeRemote();
          }
        }
      }catch(e){ console.warn('dynamic cfg load failed', e); }
    })();
    // ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø­Ø§Ù„Ø© Ø¹Ù„Ù‰ Ø§Ù„ÙˆØ§Ø¬Ù‡Ø©
    function setCloudStatus(txt, good){
      const el = document.getElementById('cloudStatus'); if(!el) return; el.textContent = txt; el.style.color = good? 'var(--accent,#0a7c5f)': 'var(--muted,#666)'; }
  if(firebase.apps && firebase.apps.length && (window.FIREBASE_CONFIG && window.FIREBASE_CONFIG.apiKey)){ setCloudStatus('Ù…ØªØµÙ„ Ø¨Ø§Ù„Ø³Ø­Ø§Ø¨Ø© (Ù…Ù„Ù)', true); REMOTE_ACTIVE = ALWAYS_REMOTE; subscribeRemote && subscribeRemote(); }
    window.addEventListener('DOMContentLoaded', ()=>{
      const k = document.getElementById('fbApiKey');
      if(!k) return;
      try{ const saved = JSON.parse(localStorage.getItem('demo_fb_cfg')||'null'); if(saved){ k.value = saved.apiKey||''; fbAuthDomain.value = saved.authDomain||''; fbProjectId.value = saved.projectId||''; fbBucket.value = saved.storageBucket||''; } }catch(e){}
      document.getElementById('saveFbCfg').addEventListener('click', ()=>{
        const cfg = { apiKey: fbApiKey.value.trim(), authDomain: fbAuthDomain.value.trim(), projectId: fbProjectId.value.trim(), storageBucket: fbBucket.value.trim() };
        if(!cfg.apiKey || !cfg.projectId){ setCloudStatus('Ø£ÙƒÙ…Ù„ Ø§Ù„Ø­Ù‚ÙˆÙ„ Ø§Ù„Ù…Ø·Ù„ÙˆØ¨Ø©', false); return; }
        localStorage.setItem('demo_fb_cfg', JSON.stringify(cfg));
        try{
          if(!firebase.apps.length){ firebase.initializeApp(cfg); }
          firebaseDb = firebase.firestore();
          FIREBASE.apiKey = cfg.apiKey; FIREBASE.authDomain = cfg.authDomain; FIREBASE.projectId = cfg.projectId; FIREBASE.storageBucket = cfg.storageBucket;
          REMOTE_ACTIVE = ALWAYS_REMOTE; setCloudStatus('Ù…ØªØµÙ„ Ø¨Ø§Ù„Ø³Ø­Ø§Ø¨Ø©', true);
          subscribeRemote && subscribeRemote();
        }catch(e){ setCloudStatus('ÙØ´Ù„ Ø§Ù„ØªÙ‡ÙŠØ¦Ø©', false); }
      });
      document.getElementById('clearFbCfg').addEventListener('click', ()=>{
        localStorage.removeItem('demo_fb_cfg'); setCloudStatus('ØªÙ… Ø­Ø°Ù Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª â€” ØºÙŠØ± Ù…ØªØµÙ„', false); if(firebase.apps && firebase.apps.length){ try{ firebase.app().delete(); }catch(e){} } REMOTE_ACTIVE = false;
      });
    });

    // Ø§Ø´ØªØ±Ø§Ùƒ ÙÙˆØ±ÙŠ Ù„Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø³Ø­Ø§Ø¨ÙŠØ©
    const itemIds = new Set();
    function subscribeRemote(){
      if(!FIREBASE_ENABLED){
        uploadHint.textContent = 'Ø§Ù„ÙˆØ¶Ø¹ Ø§Ù„Ø³Ø­Ø§Ø¨ÙŠ Ù…ÙÙØ¹Ù„ Ù„ÙƒÙ† Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Firebase ÙØ§Ø±ØºØ© â€” Ø§Ù…Ù„Ø£ Ø§Ù„Ù…ÙØ§ØªÙŠØ­';
        return;
      }
      firebaseDb.collection('shared_items').orderBy('updatedAt','desc').limit(500)
        .onSnapshot(snap => {
          snap.docChanges().forEach(ch => {
            const data = ch.doc.data();
            if(ch.type === 'removed'){
              // Ø¥Ø²Ø§Ù„Ø© Ù…Ù† Ø§Ù„ÙˆØ§Ø¬Ù‡Ø© ÙˆØ§Ù„Ù…ØµÙÙˆÙØ©
              const el = sharePreview.querySelector(`[data-id="${data.id}"]`);
              if(el) el.remove();
              itemIds.delete(data.id);
              items = items.filter(x=> x.id !== data.id);
            } else { // added or modified
              if(!data.id) return;
              if(!itemIds.has(data.id)){
                itemIds.add(data.id);
                items.push(data);
                renderItem(data);
              } else {
                // ØªØ­Ø¯ÙŠØ« Ø¨Ø³ÙŠØ·: Ø§Ø³ØªØ¨Ø¯Ø§Ù„ Ø§Ù„Ø¹Ù†ØµØ± Ù…Ø­Ù„ÙŠÙ‹Ø§ (Ø¨Ø¯ÙˆÙ† Ø¥Ø¹Ø§Ø¯Ø© Ø±Ø³Ù… Ù…ÙƒØ«ÙØ© Ø§Ù„Ø¢Ù†)
                items = items.map(x=> x.id===data.id? data : x);
              }
            }
          });
          uploadHint.textContent = `ØªÙ…Øª Ù…Ø²Ø§Ù…Ù†Ø© ${items.length} Ø¹Ù†ØµØ± Ù…Ù† Ø§Ù„Ø³Ø­Ø§Ø¨Ø©`;
        }, err => {
          console.warn('remote subscribe error', err);
          uploadHint.textContent = 'ÙØ´Ù„ Ø§Ù„Ø§Ø´ØªØ±Ø§Ùƒ Ø§Ù„Ø³Ø­Ø§Ø¨ÙŠ';
        });
    }

  if(REMOTE_ACTIVE) {
      // Ø³Ù†Ø´ØªØ±Ùƒ Ø¨Ø¹Ø¯ ØªØ­Ù…ÙŠÙ„ Ø§Ù„ØµÙØ­Ø© Ù…Ø¨Ø§Ø´Ø±Ø©
      window.addEventListener('DOMContentLoaded', ()=> subscribeRemote());
    }

    async function saveMetaToFirestore(it){
      if(!firebaseDb) return;
      try{
        const docRef = firebaseDb.collection('shared_items').doc(it.id);
        const payload = Object.assign({}, it, {updatedAt: firebase.firestore.FieldValue.serverTimestamp()});
        await docRef.set(payload);
      }catch(e){ console.warn('saveMetaToFirestore failed', e); }
    }

    async function uploadToFirebaseStorage(file){
      if(!FIREBASE_ENABLED || !FIREBASE.storageBucket) throw new Error('firebase storage not configured');
      try{
        const id = makeId();
        const path = `shared/${id}_${file.name.replace(/[^a-zA-Z0-9.\-_]/g,'_')}`;
        const ref = firebase.storage().ref().child(path);
        const snap = await ref.put(file);
        const url = await snap.ref.getDownloadURL();
        return { url, path, id };
      }catch(e){ console.warn('uploadToFirebaseStorage failed', e); throw e; }
    }

    async function loadMetaFromFirestore(){
      if(!firebaseDb) return [];
      try{
        const snap = await firebaseDb.collection('shared_items').orderBy('updatedAt','desc').limit(500).get();
        const arr = [];
        snap.forEach(d=> arr.push(d.data()));
        return arr;
      }catch(e){ console.warn('loadMetaFromFirestore failed', e); return []; }
    }

    const fileInput = document.getElementById('fileInput');
    const uploadHint = document.getElementById('uploadHint');
    const sharePreview = document.getElementById('sharePreview');
    const urlInput = document.getElementById('urlInput');
    const addUrlBtn = document.getElementById('addUrlBtn');

    // Optional Cloudinary config: fill these to enable cloud uploads
    const CLOUDINARY = {
      cloudName: '', // e.g. 'your-cloud-name'
      uploadPreset: '' // e.g. 'unsigned-preset' (must be created in your Cloudinary dashboard)
    };

    async function uploadToCloudinary(file){
      if(!CLOUDINARY.cloudName || !CLOUDINARY.uploadPreset) throw new Error('cloudinary not configured');
      const url = `https://api.cloudinary.com/v1_1/${CLOUDINARY.cloudName}/upload`;
      const fd = new FormData();
      fd.append('file', file);
      fd.append('upload_preset', CLOUDINARY.uploadPreset);
      const resp = await fetch(url, { method: 'POST', body: fd });
      if(!resp.ok) throw new Error('upload failed');
      return resp.json(); // contains secure_url etc.
    }

  // (Ø²Ø± Ù…Ø³Ø­ Ø§Ù„Ù…Ø­ÙÙˆØ¸Ø§Øª Ø£ÙØ²ÙŠÙ„ â€” Ù„Ø§ Ø­Ø§Ø¬Ø© Ù„Ø¥Ù†Ø´Ø§Ø¦Ù‡ Ù‡Ù†Ø§)

    const STORAGE_KEY = 'demo_share_items_v1';
    const MAX_PERSIST_BYTES = 2 * 1024 * 1024; // 2MB per file
    let items = []; // persisted items
    // IndexedDB Ù„Ø¯Ø¹Ù… Ø­ÙØ¸ Ø§Ù„Ù…Ù„ÙØ§Øª Ø§Ù„ÙƒØ¨ÙŠØ±Ø© Ù…Ø­Ù„ÙŠÙ‹Ø§ (Safari/iOS)
    const USE_INDEXED_DB = true;
    const IDB_DB_NAME = 'demo_share_files';
    const IDB_STORE = 'files';
    let idbDb = null;

    function openShareDb(){
      return new Promise((resolve,reject)=>{
        if(idbDb) return resolve(idbDb);
        if(!USE_INDEXED_DB || !('indexedDB' in window)) return resolve(null);
        const req = indexedDB.open(IDB_DB_NAME, 1);
        req.onupgradeneeded = (e)=>{
          const db = e.target.result;
            if(!db.objectStoreNames.contains(IDB_STORE)){
              const store = db.createObjectStore(IDB_STORE, { keyPath: 'id' });
              store.createIndex('updatedAt','updatedAt',{unique:false});
            }
        };
        req.onsuccess = (e)=>{ idbDb = e.target.result; resolve(idbDb); };
        req.onerror = ()=> resolve(null); // Ù„Ø§ Ù†ÙÙØ´Ù„ Ø§Ù„ØªØ·Ø¨ÙŠÙ‚
      });
    }

    async function saveBlobToDb(id, file){
      const db = await openShareDb();
      if(!db) return false;
      return new Promise(res=>{
        try{
          const tx = db.transaction(IDB_STORE,'readwrite');
          tx.objectStore(IDB_STORE).put({id, name:file.name, type:file.type, size:file.size, updatedAt:Date.now(), blob:file});
          tx.oncomplete = ()=> res(true);
          tx.onerror = ()=> res(false);
        }catch(e){ res(false); }
      });
    }

    async function deleteFromDb(id){
      const db = await openShareDb();
      if(!db) return;
      try{
        const tx = db.transaction(IDB_STORE,'readwrite');
        tx.objectStore(IDB_STORE).delete(id);
      }catch(e){ /* ignore */ }
    }

    async function loadAllFromDb(){
      const db = await openShareDb();
      if(!db) return [];
      return new Promise(resolve=>{
        try{
          const tx = db.transaction(IDB_STORE,'readonly');
          const req = tx.objectStore(IDB_STORE).getAll();
          req.onsuccess = ()=> resolve(req.result || []);
          req.onerror = ()=> resolve([]);
        }catch(e){ resolve([]); }
      });
    }

    function saveState(){
  if(REMOTE_ACTIVE) return; // Ù„Ø§ Ø­ÙØ¸ Ù…Ø­Ù„ÙŠ ÙÙŠ Ø§Ù„ÙˆØ¶Ø¹ Ø§Ù„Ø³Ø­Ø§Ø¨ÙŠ Ø§Ù„ÙØ¹Ù‘Ø§Ù„
      try{ localStorage.setItem(STORAGE_KEY, JSON.stringify(items)); }
      catch(e){ console.warn('save failed', e); }
    }

    function loadState(){
      if(ALWAYS_REMOTE && !FIREBASE_ENABLED){
        uploadHint.textContent = 'Firebase ØºÙŠØ± Ù…Ø¶Ø¨ÙˆØ· â€” Ø³ÙŠØªÙ… Ø§Ù„Ø­ÙØ¸ Ù…Ø­Ù„ÙŠÙ‹Ø§ Ù…Ø¤Ù‚ØªÙ‹Ø§';
      } else if(REMOTE_ACTIVE){
        uploadHint.textContent = 'Ø¬Ø§Ø±Ù Ø¬Ù„Ø¨ Ø§Ù„Ø¹Ù†Ø§ØµØ± Ù…Ù† Ø§Ù„Ø³Ø­Ø§Ø¨Ø©...';
        return; // Ø§Ù„Ø§Ø´ØªØ±Ø§Ùƒ Ø³ÙŠØ¹Ø§Ù„Ø¬ Ø§Ù„Ø¨Ø§Ù‚ÙŠ
      }
      try{
        const raw = localStorage.getItem(STORAGE_KEY);
        if(!raw) return;
        items = JSON.parse(raw) || [];
        items.forEach(it=> renderItem(it));
        if(items.length) uploadHint.textContent = `ØªØ­Ù…ÙŠÙ„ ${items.length} Ø¹Ù†ØµØ± Ù…Ø­ÙÙˆØ¸`;      
      }catch(e){ console.warn('load failed', e); }
      // ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ù…Ù„ÙØ§Øª Ø§Ù„ÙƒØ¨ÙŠØ±Ø© Ù…Ù† IndexedDB
      (async ()=>{
        const dbItems = await loadAllFromDb();
        const existing = new Set(items.map(x=>x.id));
        let added = 0;
        dbItems.forEach(row=>{
          if(!existing.has(row.id)){
            const objUrl = URL.createObjectURL(row.blob);
            const meta = {id:row.id, kind:'file', name: row.name, url: objUrl, type: row.type || 'application/octet-stream', storage:'idb'};
            items.push(meta);
            renderItem(meta);
            added++;
          }
        });
        if(added){
          uploadHint.textContent = `ØªØ­Ù…ÙŠÙ„ ${items.length} Ø¹Ù†ØµØ± (Ø¨ÙŠÙ†Ù‡Ø§ Ù…Ù„ÙØ§Øª ÙƒØ¨ÙŠØ±Ø©)`;
        }
      })();
    }

    function makeId(){ return Date.now().toString(36) + '-' + Math.random().toString(36).slice(2,8); }

    function renderItem(it){
      // reuse addPreview-like DOM but don't repersist
      const wrapper = document.createElement('div');
      wrapper.className = 'preview-item';
      wrapper.dataset.id = it.id;
      wrapper.style.padding = '8px';
      wrapper.style.border = '1px solid rgba(0,0,0,0.06)';
      wrapper.style.borderRadius = '8px';
      wrapper.style.marginBottom = '8px';
      wrapper.style.display = 'flex';
      wrapper.style.alignItems = 'center';
      wrapper.style.gap = '10px';

      const info = document.createElement('div');
      info.style.flex = '1';
      const title = document.createElement('div');
      title.textContent = it.name || it.url;
      title.style.fontWeight = '600';
      info.appendChild(title);

      const url = it.dataUrl || it.url;

      if(it.type && it.type.startsWith('image/') && url){
        const img = document.createElement('img');
        img.src = url;
        img.alt = it.name || '';
        img.style.maxWidth = '120px';
        img.style.borderRadius = '6px';
        img.style.objectFit = 'cover';
        img.style.cursor = 'pointer';
        img.addEventListener('click', ()=> window.open(url, '_blank', 'noopener'));
        wrapper.appendChild(img);
      } else if(it.type && it.type.startsWith('video/') && url){
        const vid = document.createElement('video');
        vid.src = url;
        vid.controls = true;
        vid.style.maxWidth = '160px';
        vid.style.borderRadius = '6px';
        vid.style.cursor = 'pointer';
        vid.addEventListener('click', ()=> window.open(url, '_blank', 'noopener'));
        wrapper.appendChild(vid);
      } else {
        const fileIcon = document.createElement('div');
        fileIcon.textContent = 'ğŸ“„';
        fileIcon.style.fontSize = '40px';
        fileIcon.style.lineHeight = '1';
        fileIcon.style.marginInlineEnd = '8px';
        fileIcon.style.cursor = 'pointer';
        if(url) fileIcon.addEventListener('click', ()=> window.open(url, '_blank', 'noopener'));
        wrapper.appendChild(fileIcon);
      }

      const actions = document.createElement('div');
      actions.style.display = 'flex';
      actions.style.flexDirection = 'column';
      actions.style.gap = '6px';

      const saveBtn = document.createElement('button');
      saveBtn.textContent = 'Ø­ÙØ¸';
      saveBtn.className = 'btn';
      // download helper: supports data: and object URLs; tries fetch for external URLs
      async function downloadUrl(urlToFetch, filename){
        try{
          if(urlToFetch.startsWith('data:') || urlToFetch.startsWith('blob:')){
            const a = document.createElement('a');
            a.href = urlToFetch;
            a.download = filename || 'file';
            document.body.appendChild(a);
            a.click();
            a.remove();
            return true;
          }
          // try fetching as blob
          const resp = await fetch(urlToFetch, {mode: 'cors'});
          if(!resp.ok) throw new Error('fetch failed');
          const blob = await resp.blob();
          const obj = URL.createObjectURL(blob);
          const a = document.createElement('a');
          a.href = obj;
          a.download = filename || (urlToFetch.split('/').pop().split('?')[0] || 'file');
          document.body.appendChild(a);
          a.click();
          a.remove();
          URL.revokeObjectURL(obj);
          return true;
        }catch(e){
          return false;
        }
      }

      saveBtn.addEventListener('click', async ()=>{
        if(!url){ uploadHint.textContent = 'Ù„Ø§ ÙŠÙˆØ¬Ø¯ Ø±Ø§Ø¨Ø· Ù„Ù„Ø­ÙØ¸'; return }
        uploadHint.textContent = 'Ø¬Ø§Ø±ÙŠ Ø§Ù„ØªØ­Ø¶ÙŠØ± Ù„Ù„Ø­ÙØ¸...';
        const ok = await downloadUrl(url, (it && it.name) || 'file');
        if(ok) uploadHint.textContent = 'ØªÙ… ØªÙ†Ø²ÙŠÙ„ Ø§Ù„Ù…Ù„Ù';
        else { uploadHint.textContent = 'ØªØ¹Ø°Ø± Ø§Ù„ØªÙ†Ø²ÙŠÙ„ ØªÙ„Ù‚Ø§Ø¦ÙŠÙ‹Ø§ â€” Ø³ÙŠÙØªØ­ ÙÙŠ ØªØ¨ÙˆÙŠØ¨ Ø¬Ø¯ÙŠØ¯'; window.open(url, '_blank', 'noopener'); }
      });
      actions.appendChild(saveBtn);

      const removeBtn = document.createElement('button');
      removeBtn.textContent = 'Ø¥Ø²Ø§Ù„Ø©';
      removeBtn.className = 'btn';
      removeBtn.addEventListener('click', async ()=>{
        wrapper.remove();
        items = items.filter(x=> x.id !== it.id);
        if(REMOTE_ACTIVE){
          try{
            await firebaseDb.collection('shared_items').doc(it.id).delete();
            if(it.storagePath){
              try{ await firebase.storage().ref().child(it.storagePath).delete(); }catch(e){ console.warn('storage delete failed', e); }
            }
            uploadHint.textContent = 'ØªÙ… Ø­Ø°Ù Ø§Ù„Ø¹Ù†ØµØ± Ù…Ù† Ø§Ù„Ø³Ø­Ø§Ø¨Ø©';
          }catch(e){ uploadHint.textContent = 'ØªØ¹Ø°Ø± Ø­Ø°Ù Ø§Ù„Ø³Ø­Ø§Ø¨ÙŠ'; }
        } else {
          saveState();
          if(it.storage === 'idb') deleteFromDb(it.id);
        }
      });
      actions.appendChild(removeBtn);

      wrapper.appendChild(info);
      wrapper.appendChild(actions);
      sharePreview.appendChild(wrapper);
    }

    function addAndPersistItem(obj){
      // obj: {kind:'file'|'link', name, url, type, dataUrl?}
      const it = Object.assign({id: makeId()}, obj);
      items.push(it);
  if(!REMOTE_ACTIVE) saveState();
  renderItem(it);
  if(FIREBASE_ENABLED) saveMetaToFirestore(it); // Ù†Ø­ÙØ¸ Ø§Ù„Ù…ÙŠØªØ§Ø¯Ø§ØªØ§ Ù…ØªÙ‰ ØªÙˆÙØ±Øª Firebase
    }

    function handleFiles(files){
      if(!files || files.length === 0){ uploadHint.textContent = 'Ù„Ù… ÙŠØªÙ… Ø§Ø®ØªÙŠØ§Ø± Ù…Ù„ÙØ§Øª'; return }
      uploadHint.textContent = `ØªÙ… Ø§Ø®ØªÙŠØ§Ø± ${files.length} Ù…Ù„Ù`;
      Array.from(files).forEach(async (f)=>{
        if(ALWAYS_REMOTE && !FIREBASE_ENABLED){
          // Ø§Ù„Ø³Ù…Ø§Ø­ Ø¨Ø§Ù„Ø§Ø³ØªÙ…Ø±Ø§Ø± Ù…Ø­Ù„ÙŠÙ‹Ø§
          uploadHint.textContent = 'Ø±ÙØ¹ Ù…Ø­Ù„ÙŠ Ù…Ø¤Ù‚Øª (Firebase ØºÙŠØ± Ù…Ø¶Ø¨ÙˆØ·)';
        }
        // Prefer Firebase Storage upload if configured
        if(FIREBASE_ENABLED && FIREBASE.storageBucket){
          uploadHint.textContent = `Ø¬Ø§Ø±Ù Ø±ÙØ¹ ${f.name} Ø¥Ù„Ù‰ Firebase Storage...`;
          try{
            const res = await uploadToFirebaseStorage(f);
            if(res && res.url){
              addAndPersistItem({kind:'file', name: f.name, url: res.url, type: f.type || 'application/octet-stream', storagePath: res.path, uploaded: true});
              uploadHint.textContent = `ØªÙ… Ø±ÙØ¹ ${f.name} ÙˆØ­ÙØ¸ Ø§Ù„Ø±Ø§Ø¨Ø· ÙÙŠ Ø§Ù„Ø³Ø­Ø§Ø¨Ø©`;
              return;
            }
          }catch(e){ console.warn('firebase storage upload failed', e); /* fallthrough to other options */ }
        }

        // If Firebase not used, try Cloudinary if configured
        if(CLOUDINARY.cloudName && CLOUDINARY.uploadPreset){
          uploadHint.textContent = `Ø¬Ø§Ø±Ù Ø±ÙØ¹ ${f.name} Ø¥Ù„Ù‰ Cloudinary...`;
          try{
            const res = await uploadToCloudinary(f);
            const remote = res.secure_url || res.url;
            if(remote){
              addAndPersistItem({kind:'file', name: f.name, url: remote, type: f.type || 'application/octet-stream', uploaded: true});
              uploadHint.textContent = `ØªÙ… Ø±ÙØ¹ ${f.name} ÙˆØ­ÙØ¸ Ø§Ù„Ø±Ø§Ø¨Ø· ÙÙŠ Ø§Ù„Ø³Ø­Ø§Ø¨Ø©`;
              return;
            }
          }catch(err){ console.warn('cloud upload failed', err); }
        }

        // local fallback: persist small files as dataURL, or preview large ones
        if(!REMOTE_ACTIVE && f.size <= MAX_PERSIST_BYTES){
          const reader = new FileReader();
          reader.onload = (ev)=>{
            const dataUrl = ev.target.result;
            addAndPersistItem({kind:'file', name: f.name, url: dataUrl, dataUrl, type: f.type || 'application/octet-stream'});
            uploadHint.textContent = `ØªÙ… Ø­ÙØ¸ ${f.name} Ù…Ø­Ù„ÙŠÙ‹Ø§`;
          };
          reader.readAsDataURL(f);
        } else if(!REMOTE_ACTIVE) {
          // Ù…Ø­Ø§ÙˆÙ„Ø© Ø­ÙØ¸ Ø§Ù„Ù…Ù„Ù Ø§Ù„ÙƒØ¨ÙŠØ± ÙÙŠ IndexedDB
          const id = makeId();
          const ok = await saveBlobToDb(id, f);
          if(ok){
            const url = URL.createObjectURL(f);
            items.push({id, kind:'file', name:f.name, url, type:f.type||'application/octet-stream', storage:'idb'});
            renderItem(items[items.length-1]);
            saveState(); // Ù†Ø­ÙØ¸ Ø§Ù„Ù…ÙŠØªØ§Ø¯Ø§ØªØ§ ÙÙ‚Ø·
            uploadHint.textContent = 'ØªÙ… Ø­ÙØ¸ Ø§Ù„Ù…Ù„Ù Ø§Ù„ÙƒØ¨ÙŠØ± Ù…Ø­Ù„ÙŠÙ‹Ø§ (Ù‚Ø§Ø¹Ø¯Ø© Ø¨ÙŠØ§Ù†Ø§Øª)';
          } else {
            const url = URL.createObjectURL(f);
            renderItem({id, kind:'file', name: f.name, url, type: f.type});
            uploadHint.textContent = 'ØªÙ…Øª Ø§Ù„Ù…Ø¹Ø§ÙŠÙ†Ø© ÙÙ‚Ø· (ØªØ¹Ø°Ø± Ø­ÙØ¸ Ø§Ù„Ù…Ù„Ù Ø§Ù„ÙƒØ¨ÙŠØ±)';
          }
        }
      });
    }

    fileInput && fileInput.addEventListener('change', (e)=> handleFiles(e.target.files));

    addUrlBtn && addUrlBtn.addEventListener('click', ()=>{
      const v = (urlInput && urlInput.value || '').trim();
      if(!v) return;
      const ext = v.split('.').pop().toLowerCase().split(/[#?]/)[0];
      let type = '';
      if(['png','jpg','jpeg','webp','gif','svg'].includes(ext)) type = 'image/' + (ext==='jpg'?'jpeg':ext);
      if(['mp4','webm','ogg'].includes(ext)) type = 'video/' + ext;
      addAndPersistItem({kind:'link', name: v.split('/').pop() || v, url: v, type});
      uploadHint.textContent = 'ØªÙ…Øª Ø¥Ø¶Ø§ÙØ© Ø±Ø§Ø¨Ø· Ù…Ø­ÙÙˆØ¸ (ØªØ¬Ø±ÙŠØ¨ÙŠ)';
      urlInput.value = '';
    });

  // Ù…Ø³Ø­ Ø§Ù„Ù…Ø­ÙÙˆØ¸Ø§Øª Ù…ÙØ¯Ø§Ø± Ø§Ù„Ø¢Ù† ÙŠØ¯ÙˆÙŠÙ‹Ø§ Ø¥Ù† Ù„Ø²Ù…Ø› Ø²Ø± Ø§Ù„Ø¥Ø²Ø§Ù„Ø© Ø£ÙØ²ÙŠÙ„ Ù…Ù† Ø§Ù„ÙˆØ§Ø¬Ù‡Ø©

  // labels contain the file input; default label behavior opens the picker â€” no manual click needed

    // load persisted items on start
    loadState();
  </script>

</body>
</html>
