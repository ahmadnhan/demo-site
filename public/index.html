<!doctype html>
<html lang="ar" dir="rtl">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>ุฏููู ุณุงูุช โ ูุดุงุฑูุน ูุฑูุงุจุท</title>
  <link rel="stylesheet" href="styles.css">
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Amiri&family=Cairo:wght@300;400;700&display=swap" rel="stylesheet">
</head>
<body>
  <header class="hero">
    <div class="container" style="position:relative">
      <div class="brand">
        <h1>ุฏููู ุณุงูุช</h1>
        <p class="tag" data-i18n="tagline">ูุญูุธุฉ ูุฑูุงุจุท ุฎุงุตุฉ โ ุนุฑุถ ุณุฑูุน ููุดุฑูุนุงุชู ูุฑูุงุจุทู ุงููููุฉ</p>
      </div>
      <!-- header controls: dark mode + language -->
      <div class="header-controls">
        <label class="hdr-switch" aria-label="ุงููุถุน ุงููููู"><input type="checkbox" id="darkToggle" /><span class="icon" aria-hidden="true">๐</span></label>
        <select id="langSelect" aria-label="language">
          <option value="ar">ุงูุนุฑุจูุฉ</option>
          <option value="en">English</option>
        </select>
      </div>
    </div>
  </header>

  <main class="container">
    <section id="projects" class="section">
      <h2 data-i18n="projects_h2" style="text-align:center">ุงููุดุงุฑูุน</h2>
      <div class="grid">
        <article class="card">
          <div class="card-head" data-i18n="project1_title">ุฑูุงุจุท ูููุนู</div>
          <p class="muted" data-i18n="project1_desc">ููุงูุน ุงูุชุฌุฑูุจูู ุฎุงุตู ุจู</p>
          <div class="actions">
            <a class="muted" href="https://ahmadnhan.github.io/mysite/" target="_blank" rel="noopener" data-i18n="converter_site_link">ูููุน ุชุญููู ุงูุชุงุฑูุฎ</a>
          </div>
        </article>
        <article class="card">
          <div class="card-head" data-i18n="project2_title">ุชุทุจููุงุชู</div>
          <p class="muted">ุฑูุงุจุท ุชุญููู ุชุทุจููุงุช</p>
          <div class="actions">
            <a class="muted" href="https://www.mediafire.com/file/fekgcz3s4tl8326/app3719549-ghn059.apk/file" target="_blank" rel="noopener" data-i18n="app_converter_title">ุชุทุจูู ุชุญููู ุชุงุฑูุฎ</a>
          </div>
        </article>
      </div>
    </section>

      <!-- New: file sharing card (ุธูุฑ ูุจู ุชูุงุตู) -->
      <section id="share" class="section">
        <h2 style="text-align:center">ูุดุงุฑูุฉ ูููุงุช ุนุจุฑ ุงููููุน</h2>
        <div class="card">
          <div class="card-head" style="display:flex;justify-content:space-between;align-items:center;gap:12px">
            <span>ูุดุงุฑูุฉ ูููุงุช ุนุจุฑ ุงููููุน</span>
            <span id="cloudModeStatus" style="font-size:12px;padding:4px 8px;border-radius:16px;background:#f1f5f9;color:#333;letter-spacing:.5px">...ุชุญูู</span>
          </div>
          <p class="muted">ููููู ุงุฎุชูุงุฑ ููู ููุดุงุฑูุชู ุนุจุฑ ุฑุงุจุท (ุชุฌุฑูุจู). ูุฐู ุงููุงุฌูุฉ ุชูุถูุญูุฉ ููุท ููุง ุชุฑูุน ุงูููู ูุนูููุง ูู ูุฐุง ุงูุฅุตุฏุงุฑ.</p>
          <div class="actions">
            <label class="btn" style="cursor:pointer">
              <input type="file" id="fileInput" style="display:none" accept="*/*" multiple />
              ุฑูุน ููู
            </label>
            <input id="urlInput" type="url" placeholder="ุงูุตู ุฑุงุจุท (ุตูุฑุฉ/ููุฏูู/ููุฏูุง) ูุฃุถู" style="margin-inline-start:8px;padding:6px;border-radius:6px;border:1px solid var(--muted,#ccc)" />
            <button id="addUrlBtn" class="btn" style="margin-inline-start:6px">ุฃุถู ุฑุงุจุท</button>
            
            <div id="uploadHint" class="muted" style="display:block;margin-top:8px">ูู ูุชู ุงุฎุชูุงุฑ ูููุงุช ุฃู ุฑูุงุจุท</div>
            <div id="itemsCount" class="muted" style="display:block;margin-top:4px;font-size:12px;opacity:.8">0 ุนูุงุตุฑ</div>
            <div id="uploadProgress" style="display:none;width:100%;background:#e2e8f0;border-radius:6px;height:8px;margin-top:8px;overflow:hidden">
              <div id="uploadBar" style="height:100%;width:0;background:linear-gradient(90deg,#0ea5e9,#38bdf8);transition:width .2s"></div>
            </div>
          </div>
          <div id="sharePreview" class="share-preview" style="margin-top:10px"></div>
        </div>
      </section>

    <section id="contact" class="section">
      <h2 data-i18n="contact_h2">ุชูุงุตู</h2>
      <div class="contact">
        <p class="muted" data-i18n="contact_text">ููููู ูุถุน ุฅูููู ุฃู ูููุฐุฌ ุชูุงุตู ููุง.</p>
        <div class="contact-info">
          <a class="email green-btn" href="mailto:ahmad14088@gmail.com" aria-label="ahmad14088@gmail.com" title="ahmad14088@gmail.com">
            <span class="mail-icon" aria-hidden="true">โ๏ธ</span>
          </a>
        </div>
      </div>
    </section>

    <footer class="site-footer">
  <div>ยฉ <span id="year"></span> <span class="site-name" data-i18n="site_name">ุฏููู ุณุงูุช</span> โ <span data-i18n="rights">ุฌููุน ุงูุญููู ูุญููุธุฉ</span></div>
    </footer>
  </main>

  <script>
    document.getElementById('year').textContent = new Date().getFullYear();

    // Dark mode toggle + persistence
    const darkToggle = document.getElementById('darkToggle');
    function setDark(on){
      if(on) document.documentElement.classList.add('dark');
      else document.documentElement.classList.remove('dark');
      try{ localStorage.setItem('demo_dark', on ? '1' : '0') }catch(e){}
      darkToggle.checked = !!on;
    }
    darkToggle.addEventListener('change', (e)=> setDark(e.target.checked));
    // restore theme from storage
    try{ if(localStorage.getItem('demo_dark') === '1') setDark(true) }catch(e){}

    // Simple i18n
    const i18n = {
      en: {
        tagline: 'Portfolio & links โ quick view of my projects',
        projects_h2: 'Projects',
        project1_title: 'My site links',
        project1_desc: 'My demo sites',
        project2_title: 'My apps',
        project2_desc: 'Hijri/Gregorian date converter (downloadable).',
        app_converter_title: 'Date converter app',
        contact_h2: 'Contact',
        contact_text: 'Place an email or contact form here.',
        site_name: 'Demo Site',
        rights: 'All rights reserved'
      },
      ar: {
        tagline: 'ูุญูุธุฉ ูุฑูุงุจุท ุฎุงุตุฉ โ ุนุฑุถ ุณุฑูุน ููุดุฑูุนุงุชู ูุฑูุงุจุทู ุงููููุฉ',
        projects_h2: 'ุงููุดุงุฑูุน',
        project1_title: 'ุฑูุงุจุท ูููุนู',
        project1_desc: 'ููุงูุน ุงูุชุฌุฑูุจูู ุฎุงุตู ุจู',
        project2_title: 'ุชุทุจููุงุชู',
        project2_desc: 'ูุญูู ุชูุงุฑูุฎ ูุฌุฑู/ูููุงุฏู (ูุงุจู ููุชุญููู).',
        app_converter_title: 'ุชุทุจูู ุชุญููู ุชุงุฑูุฎ',
        contact_h2: 'ุชูุงุตู',
        contact_text: 'ููููู ูุถุน ุฅูููู ุฃู ูููุฐุฌ ุชูุงุตู ููุง.',
        site_name: 'ุฏููู ุณุงูุช',
        rights: 'ุฌููุน ุงูุญููู ูุญููุธุฉ'
      }
    };
    const langSelect = document.getElementById('langSelect');
    function applyLang(lang){
      document.documentElement.lang = lang;
      document.documentElement.dir = (lang === 'ar') ? 'rtl' : 'ltr';
      document.querySelectorAll('[data-i18n]').forEach(el=>{
        const key = el.getAttribute('data-i18n');
        if(i18n[lang] && i18n[lang][key]) el.textContent = i18n[lang][key];
      });
      try{ localStorage.setItem('demo_lang', lang) }catch(e){}
    }
    langSelect.addEventListener('change', ()=>applyLang(langSelect.value));
    try{
      const saved = localStorage.getItem('demo_lang');
      if(saved){ langSelect.value = saved }
    }catch(e){}
    applyLang(langSelect.value);

    // Reveal animations using IntersectionObserver
    const io = new IntersectionObserver((entries)=>{
      entries.forEach(ent=>{
        if(ent.isIntersecting) ent.target.classList.add('in-view');
      });
    },{threshold:0.12});
    document.querySelectorAll('.card, .section').forEach(el=>{ el.classList.add('reveal'); io.observe(el) });
  </script>
  
  <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-app.js"></script>
  <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-firestore.js"></script>
  <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-storage.js"></script>
  <script src="firebase-config.js"></script>
  <script>
    // ุฏุนู ุฑูุน ุณุญุงุจู (Firestore + Storage) ูุน Fallback ูุญูู
    const FIREBASE_CFG = (window.FIREBASE_CONFIG && window.FIREBASE_CONFIG.apiKey)? window.FIREBASE_CONFIG : null;
    let firebaseDb = null;
    let firebaseStorage = null;
    let CLOUD_ACTIVE = false;
  const cloudModeStatusEl = document.getElementById('cloudModeStatus');
  const itemsCountEl = document.getElementById('itemsCount');
  function setCloudBadge(txt, ok){ if(!cloudModeStatusEl) return; cloudModeStatusEl.textContent = txt; cloudModeStatusEl.style.background = ok? 'linear-gradient(90deg,#16a34a,#22c55e)' : '#f1f5f9'; cloudModeStatusEl.style.color = ok? '#fff':'#333'; }

  try {
      if(FIREBASE_CFG){
        firebase.initializeApp(FIREBASE_CFG);
        firebaseDb = firebase.firestore();
        firebaseStorage = firebase.storage();
        CLOUD_ACTIVE = true;
    setCloudBadge('ุณุญุงุจู', true);
      }
  } catch(e){ console.warn('Firebase init failed', e); setCloudBadge('ูุญูู', false); }
  if(!CLOUD_ACTIVE) setCloudBadge('ูุญูู', false);

    // ูุงุฌูุฉ ุงูุนูุงุตุฑ
    const fileInput = document.getElementById('fileInput');
    const uploadHint = document.getElementById('uploadHint');
    const sharePreview = document.getElementById('sharePreview');
    const urlInput = document.getElementById('urlInput');
    const addUrlBtn = document.getElementById('addUrlBtn');

    const STORAGE_KEY = 'demo_share_items_v1';
    const MAX_PERSIST_BYTES = 2 * 1024 * 1024; // 2MB
    let items = [];

    function makeId(){ return Date.now().toString(36) + '-' + Math.random().toString(36).slice(2,8); }

  function saveState(){ if(CLOUD_ACTIVE) return; try{ localStorage.setItem(STORAGE_KEY, JSON.stringify(items)); }catch(e){} }
  function loadState(){
    if(CLOUD_ACTIVE){
      uploadHint.textContent = 'ุฌุงุฑู ุฌูุจ ุงูุนูุงุตุฑ ูู ุงูุณุญุงุจุฉ...';
      try {
        firebaseDb.collection('shared_items').orderBy('updatedAt','desc').limit(200).onSnapshot(snap=>{
          sharePreview.innerHTML = '';
          items = [];
          snap.forEach(doc=>{ const it = doc.data(); items.push(it); renderItem(it); });
          uploadHint.textContent = `ุชูุช ูุฒุงููุฉ ${items.length} ุนูุตุฑ`;
          if(itemsCountEl) itemsCountEl.textContent = `${items.length} ุนูุตุฑ` + (items.length!==1? '': '');
        }, err=>{
          console.warn('snapshot err', err); uploadHint.textContent='ุชุนุฐุฑ ุงูุฌูุจ ุงูุณุญุงุจู';
        });
      } catch(e){ uploadHint.textContent='ุฎุทุฃ ูู ุงูุงุชุตุงู ุจุงูุณุญุงุจุฉ'; }
      return;
    }
    try{ const raw = localStorage.getItem(STORAGE_KEY); if(raw){ items = JSON.parse(raw)||[]; items.forEach(renderItem); if(items.length) uploadHint.textContent = `ุชุญููู ${items.length} ุนูุตุฑ ูุญููุธ`; } }catch(e){}
  }

    function renderItem(it){
      const wrapper = document.createElement('div');
      wrapper.className = 'preview-item';
      wrapper.dataset.id = it.id;
      wrapper.style.padding='8px';
      wrapper.style.border='1px solid rgba(0,0,0,0.06)';
      wrapper.style.borderRadius='8px';
      wrapper.style.marginBottom='8px';
      wrapper.style.display='flex';
      wrapper.style.alignItems='center';
      wrapper.style.gap='10px';

      const info = document.createElement('div'); info.style.flex='1';
      const title = document.createElement('div'); title.textContent = it.name || it.url; title.style.fontWeight='600'; info.appendChild(title);

      const url = it.dataUrl || it.url;
      if(it.type && it.type.startsWith('image/') && url){ const img=document.createElement('img'); img.src=url; img.alt=it.name||''; img.style.maxWidth='120px'; img.style.borderRadius='6px'; img.style.objectFit='cover'; img.style.cursor='pointer'; img.onclick=()=> window.open(url,'_blank','noopener'); wrapper.appendChild(img); }
      else if(it.type && it.type.startsWith('video/') && url){ const vid=document.createElement('video'); vid.src=url; vid.controls=true; vid.style.maxWidth='160px'; vid.style.borderRadius='6px'; wrapper.appendChild(vid); }
      else { const fileIcon=document.createElement('div'); fileIcon.textContent='๐'; fileIcon.style.fontSize='40px'; fileIcon.style.cursor='pointer'; if(url) fileIcon.onclick=()=> window.open(url,'_blank','noopener'); wrapper.appendChild(fileIcon); }

      const actions=document.createElement('div'); actions.style.display='flex'; actions.style.flexDirection='column'; actions.style.gap='6px';
      const saveBtn=document.createElement('button'); saveBtn.textContent='ุญูุธ'; saveBtn.className='btn';
      saveBtn.onclick=async ()=>{ if(!url){ uploadHint.textContent='ูุง ููุฌุฏ ุฑุงุจุท'; return;} try{ const resp=await fetch(url); const blob=await resp.blob(); const obj=URL.createObjectURL(blob); const a=document.createElement('a'); a.href=obj; a.download=it.name||'file'; document.body.appendChild(a); a.click(); a.remove(); URL.revokeObjectURL(obj); uploadHint.textContent='ุชู ุงูุชูุฒูู'; }catch(e){ window.open(url,'_blank','noopener'); } };
  const removeBtn=document.createElement('button'); removeBtn.textContent='ุฅุฒุงูุฉ'; removeBtn.className='btn'; removeBtn.onclick=()=>{ wrapper.remove(); items = items.filter(x=> x.id !== it.id); saveState(); if(firebaseDb) firebaseDb.collection('shared_items').doc(it.id).delete().catch(()=>{}); if(firebaseStorage && it.storagePath){ firebaseStorage.ref().child(it.storagePath).delete().catch(()=>{}); } uploadHint.textContent='ุญุฐู'; };
      actions.appendChild(saveBtn); actions.appendChild(removeBtn);

      wrapper.appendChild(info); wrapper.appendChild(actions); sharePreview.appendChild(wrapper);
    }

  async function saveMetaCloud(it){ if(!firebaseDb) return; try{ await firebaseDb.collection('shared_items').doc(it.id).set(Object.assign({}, it, {updatedAt: firebase.firestore.FieldValue.serverTimestamp()})); }catch(e){ console.warn('save meta failed', e); }}
  function showProgress(){ const c=document.getElementById('uploadProgress'); if(c) c.style.display='block'; }
  function setProgress(p){ const b=document.getElementById('uploadBar'); if(b) b.style.width = (Math.min(100, Math.max(0, p*100))).toFixed(1)+'%'; }
  function hideProgress(){ const c=document.getElementById('uploadProgress'); if(c) c.style.display='none'; setProgress(0); }
  async function uploadFileToCloud(file, onProgress){
    if(!firebaseStorage) throw new Error('No storage');
    const safeName = file.name.replace(/[^a-zA-Z0-9.\-_]/g,'_');
    const id = makeId();
    const path = `shared/${id}_${safeName}`;
    const ref = firebaseStorage.ref().child(path);
    return new Promise((resolve, reject)=>{
      const task = ref.put(file);
      task.on('state_changed', snap=>{ if(onProgress && snap.totalBytes) onProgress(snap.bytesTransferred / snap.totalBytes); }, err=> reject(err), async ()=>{ try{ const url = await task.snapshot.ref.getDownloadURL(); resolve({ url, path, id }); } catch(e){ reject(e); } });
    });
  }
  function updateCounter(){ if(itemsCountEl) itemsCountEl.textContent = `${items.length} ุนูุตุฑ`; }
  function addAndPersistItem(obj){
    const it = Object.assign({id: makeId()}, obj);
    if(CLOUD_ACTIVE){
      // ุงูุงุนุชูุงุฏ ุนูู onSnapshot ูุฅุนุงุฏุฉ ุงูุฑุณู ูุชูุงุฏู ุงูุชูุฑุงุฑ
      saveMetaCloud(it);
    } else {
      items.unshift(it);
      renderItem(it);
      saveState();
      updateCounter();
    }
  }
  function handleFiles(files){
    if(!files || !files.length){ uploadHint.textContent='ูู ูุชู ุงุฎุชูุงุฑ ูููุงุช'; return; }
    Array.from(files).forEach(async f=>{
      if(CLOUD_ACTIVE){
        try {
          uploadHint.textContent = `ุฑูุน ${f.name}...`;
          showProgress(); setProgress(0);
          const res = await uploadFileToCloud(f, p=> setProgress(p));
          const meta = {kind:'file', name:f.name, url:res.url, type:f.type||'application/octet-stream', storagePath:res.path, id:res.id};
          addAndPersistItem(meta);
          uploadHint.textContent = `ุชู ุฑูุน ${f.name}`;
          hideProgress();
          return;
        } catch(e){ console.warn('cloud upload failed', e); uploadHint.textContent='ูุดู ุงูุฑูุน ุงูุณุญุงุจู โ ุณูุชู ุญูุธ ูุญูู'; hideProgress(); }
      }
      // Fallback ูุญูู
      if(f.size <= MAX_PERSIST_BYTES){ const reader=new FileReader(); reader.onload=ev=>{ addAndPersistItem({kind:'file', name:f.name, url:ev.target.result, dataUrl:ev.target.result, type:f.type||'application/octet-stream'}); uploadHint.textContent=`ุชู ุญูุธ ${f.name} ูุญูููุง`; }; reader.readAsDataURL(f); } else { const url = URL.createObjectURL(f); addAndPersistItem({kind:'file', name:f.name, url, type:f.type||'application/octet-stream'}); uploadHint.textContent='ูุนุงููุฉ ููุท (ููู ูุจูุฑ)'; }
    });
  }

  fileInput && fileInput.addEventListener('change', e=> handleFiles(e.target.files));
  addUrlBtn && addUrlBtn.addEventListener('click', ()=>{ const v=(urlInput.value||'').trim(); if(!v) return; const ext=v.split('.').pop().toLowerCase().split(/[#?]/)[0]; let type=''; if(['png','jpg','jpeg','webp','gif','svg'].includes(ext)) type='image/'+(ext==='jpg'?'jpeg':ext); if(['mp4','webm','ogg'].includes(ext)) type='video/'+ext; addAndPersistItem({kind:'link', name:v.split('/').pop()||v, url:v, type}); uploadHint.textContent = CLOUD_ACTIVE? 'ุชูุช ุฅุถุงูุฉ ุฑุงุจุท (ุณุญุงุจู)' : 'ุชูุช ุฅุถุงูุฉ ุฑุงุจุท'; });

    // ุชุญููู ุงูุญุงูุฉ ุงููุญููุฉ
    loadState();
  </script>

</body>
</html>
